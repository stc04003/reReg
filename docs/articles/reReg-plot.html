<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualization of recurrent event data with `reReg` • reReg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualization of recurrent event data with `reReg`">
<meta property="og:description" content="reReg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reReg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reReg-cppl.html">Improving Cox-type proportional rate model with `reReg`</a>
    </li>
    <li>
      <a href="../articles/reReg-plot.html">Visualization of recurrent event data with `reReg`</a>
    </li>
    <li>
      <a href="../articles/reReg-Recur.html">Creating `Recur` objects</a>
    </li>
    <li>
      <a href="../articles/reReg-reg.html">Regression model for recurrent event data</a>
    </li>
    <li>
      <a href="../articles/reReg-sims.html">Simulating recurrent event data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stc04003/reReg/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="reReg-plot_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualization of recurrent event data with <code>reReg</code>
</h1>
                        <h4 data-toc-skip class="author">Sy Han (Steven) Chiou</h4>
            
            <h4 data-toc-skip class="date">2024-05-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stc04003/reReg/blob/HEAD/vignettes/reReg-plot.Rmd" class="external-link"><code>vignettes/reReg-plot.Rmd</code></a></small>
      <div class="hidden name"><code>reReg-plot.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we demonstrate how to create event plots and mean cumulative function in <strong><code>reReg</code></strong> package. We will illustrate the usage of our functions with the <code>readmission</code> data from the <strong><code>frailtypack</code></strong> package <span class="citation">(Rondeau, Mazroui, and González 2012)</span>, <span class="citation">(González et al. 2005)</span>. The data contains re-hospitalization times after surgery in patients diagnosed with colorectal cancer. In this data set, the recurrent event is the readmission and the terminal event is either death or end of study. See <code>?readmission</code> for data details.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(reReg)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">packageVersion</span>(<span class="st">"reReg"</span>)</span></code></pre></div>
<pre><code>[1] '1.4.6'</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(readmission, <span class="dt">package =</span> <span class="st">"frailtypack"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(readmission)</span></code></pre></div>
<pre><code>  id enum t.start t.stop time event      chemo    sex dukes charlson death
1  1    1       0     24   24     1    Treated Female     D        3     0
2  1    2      24    457  433     1    Treated Female     D        0     0
3  1    3     457   1037  580     0    Treated Female     D        0     0
4  2    1       0    489  489     1 NonTreated   Male     C        0     0
5  2    2     489   1182  693     0 NonTreated   Male     C        0     0
6  3    1       0     15   15     1 NonTreated   Male     C        3     0</code></pre>
<p>For illustration, we first remove subjects who has more than one terminal events.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>readmission &lt;-<span class="st"> </span><span class="kw">subset</span>(readmission, <span class="op">!</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">60</span>, <span class="dv">109</span>, <span class="dv">280</span>)))</span></code></pre></div>
<div class="section level2">
<h2 id="event-plots">Event plots<a class="anchor" aria-label="anchor" href="#event-plots"></a>
</h2>
<p>An easy way to glance at recurrent event data is by plotting the event plots. Event plots can be created by applying the generic function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to <code>Recur</code> objects directly, as shown in Figure 1.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>reObj &lt;-<span class="st"> </span><span class="kw">with</span>(readmission, <span class="kw">Recur</span>(t.stop, id, event, death))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(reObj)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plot-Recur-1.png" alt="Figure 1: Creating an event plot from a `Recur` object." width="576"><p class="caption">
Figure 1: Creating an event plot from a <code>Recur</code> object.
</p>
</div>
<p>The gray horizontal lines represent each subjects’ follow-up times, the green dots marks the recurrent events, and the red triangles marks terminal events. With the default setting, the event plot is arranged so that subjects with longer follow-up times are presented on the top. The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method returns a <code>ggplot2</code> object <span class="citation">(Wickham 2009)</span> to allow extensive flexibility and customization. Common graphical options like <code>xlab</code>, <code>ylab</code>, <code>main</code>, and more can be directly passed down to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(reObj, <span class="dt">cex =</span> <span class="fl">1.5</span>, <span class="dt">xlab =</span> <span class="st">"Time in days"</span>, <span class="dt">ylab =</span> <span class="st">"Patients"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="op">+</span><span class="st">      </span><span class="dt">main =</span> <span class="st">"Event plot for readmission data"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="op">+</span><span class="st">      </span><span class="dt">terminal.name =</span> <span class="st">"Death"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="op">+</span><span class="st">      </span><span class="dt">recurrent.name =</span> <span class="st">"Hospital readmission"</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plot-Recur2-1.png" alt="Figure 2: Creating an event plot from a `Recur` object with custom labels." width="576"><p class="caption">
Figure 2: Creating an event plot from a <code>Recur</code> object with custom labels.
</p>
</div>
<p>Applying the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function to <code>Recur</code> objects internally calls the <code>plotEvent()</code> function, which allows users to configure event plots in a model formula. The synopsis of <code><a href="../reference/plotEvents.html">plotEvents()</a></code> is:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">args</span>(plotEvents)</span></code></pre></div>
<pre><code><span><span class="kw">function</span> <span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"increasing"</span>, <span class="st">"decreasing"</span>, </span>
<span>    <span class="st">"asis"</span><span class="op">)</span>, <span class="va">calendarTime</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> </span>
<span><span class="cn">NULL</span></span></code></pre>
<p>The arguments are as follows</p>
<ul>
<li>
<code>formula</code> is a formula object, which contains an <code>Recur</code> object and categorical covariates separated by <code>~</code>, where the categorical covariates are used to stratify the event plot.</li>
<li>
<code>data</code> is an optional data frame in which to interpret the variables occurring in the <code>formula</code>.</li>
<li>
<code>result</code> is an optional character string specifying whether the event plot is sorted by the subjects’ terminal time. The available options are
<ul>
<li>
<code>increasing</code> sort the terminal time from in ascending order (default). This places longer terminal times on top.</li>
<li>
<code>decreasing</code> sort the terminal time from in descending order. This places shorter terminal times on top.</li>
<li>
<code>none</code> present the event plots as is, without sorting by the terminal times.</li>
</ul>
</li>
<li>
<code>calendarTime</code> is an optional logical value indicating whether to plot in calendar time. When <code>calendarTime = FALSE</code> (default), the event plot will have patient time on the x-axis.</li>
<li>
<code>control</code> is a list of control parameters.</li>
<li>
<code>...</code> are graphical parameters to be passed to the <code><a href="../reference/plotEvents.html">plotEvents()</a></code> function.</li>
</ul>
<p>The required argument for <code>plotEvent()</code> is <code>formula</code>. The full list of these parameters with their default values are displayed below.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">args</span>(reReg<span class="op">:::</span>plotEvents.control)</span></code></pre></div>
<pre><code><span><span class="kw">function</span> <span class="op">(</span><span class="va">xlab</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">ylab</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">main</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">terminal.name</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">recurrent.name</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">recurrent.type</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">legend.position</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">cex</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.7</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">bar.color</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">recurrent.color</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">recurrent.shape</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">recurrent.stroke</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">terminal.color</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">terminal.shape</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">terminal.stroke</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">not.terminal.color</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">not.terminal.shape</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span>
<span><span class="cn">NULL</span></span></code></pre>
<p>The parameters <code>xlab</code>, <code>ylab</code>, and <code>main</code> are adopted from the base <code>R</code> <code>graphics</code> package for modifying labels to the x-axis, the y-axis, and the main title, respectively. The parameters <code>terminal.name</code> and <code>recurrent.name</code> are character labels displayed in the legend. The parameter <code>recurrent.type</code> specifies the recurrent event types to be displayed in the legend when more than one recurrent event types is specified in the <code>Recur</code> object. The parameter <code>legend.position</code> is adopted from the % the <code>legend.position</code> components of the <code>ggplot2</code> theme to control the location of the legend box. The parameters <code>cex</code> and <code>alpha</code> control the size and the transparency of the symbols on the event plots, respectively. The <code>base_size</code> parameter controls the base font size in pts.</p>
<p>Stratifying the event plot could provide new insights into the different covariate effects. For example, an event plot stratified by the binary variable <code>sex</code> can be produced with the following code.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plotEvents</span>(<span class="kw">Recur</span>(t.stop, id, event, death) <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> readmission)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotEvents-gender-1.png" alt="Figure 3: Event plot grouped by `sex`" width="576"><p class="caption">
Figure 3: Event plot grouped by <code>sex</code>
</p>
</div>
<p>Similarly, event plot stratified by <code>sex</code> and <code>chemo</code> can be produced with the following code. The additional argument <code>base_size = 5</code> is included to display the full legend labels.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plotEvents</span>(<span class="kw">Recur</span>(t.stop, id, event, death) <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>chemo, <span class="dt">data =</span> readmission, <span class="dt">base_size =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotEvents-gender-chemo-1.png" alt="Figure 4: Event plot grouped by `sex` and `chemo`." width="576"><p class="caption">
Figure 4: Event plot grouped by <code>sex</code> and <code>chemo</code>.
</p>
</div>
<p>The <code><a href="../reference/plotEvents.html">plotEvents()</a></code> can accommodate multiple recurrent types specified via the event argument in the <code>Recur</code> object. To illustrate this feature, we perturb the event indicator so that the value of event indicates the index of the different recurrent event. The following command is used to create the stratified event plot with different recurrent event.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>readmission<span class="op">$</span>event2 &lt;-<span class="st"> </span><span class="kw">with</span>(readmission, <span class="kw">ifelse</span>(t.stop <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span> <span class="op">&amp;</span><span class="st"> </span>event <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">2</span>, event))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plotEvents</span>(<span class="kw">Recur</span>(t.stop, id, event2, death) <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> readmission)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotEvents-multiple-events-1.png" alt="Figure 5: Event plot with multiple events grouped by `sex`." width="576"><p class="caption">
Figure 5: Event plot with multiple events grouped by <code>sex</code>.
</p>
</div>
<p>The different types of recurrent events are marked in different colors in Figure 5. The <code><a href="../reference/plotEvents.html">plotEvents()</a></code> function can also create event plots in calendar time by setting <code>calendarTime = TRUE</code>. For illustration, we create a new simulated data based on <code>readmission</code> with time intervals shift proportionally by <code>chemo</code>. We further convert the time intervals to a <code>Date</code> class. The construction of the new data and the stratified event plot in Figure 6 is included in the following</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>readmission2 &lt;-<span class="st"> </span>readmission</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>readmission2<span class="op">$</span>t.start &lt;-<span class="st"> </span><span class="kw">as.Date</span>(readmission2<span class="op">$</span>t.start <span class="op">+</span><span class="st"> </span><span class="kw">as.numeric</span>(readmission2<span class="op">$</span>chemo) <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">origin =</span> <span class="st">"20-01-01"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>readmission2<span class="op">$</span>t.stop &lt;-<span class="st"> </span><span class="kw">as.Date</span>(readmission2<span class="op">$</span>t.stop <span class="op">+</span><span class="st"> </span><span class="kw">as.numeric</span>(readmission2<span class="op">$</span>chemo) <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="dt">origin =</span> <span class="st">"20-01-01"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plotEvents</span>(<span class="kw">Recur</span>(t.start <span class="op">%2%</span><span class="st"> </span>t.stop, id, event2, death) <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> readmission2, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a><span class="op">+</span><span class="st">            </span><span class="dt">calendarTime =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotEvents-calendar-1.png" alt="Figure 6: Event plot on calendar time." width="576"><p class="caption">
Figure 6: Event plot on calendar time.
</p>
</div>
<p>In this case, subjects with later censoring times are presented on the top and the date string are printed on the axis label of the event plot.</p>
</div>
<div class="section level2">
<h2 id="mean-cumulative-function-plots">Mean cumulative function plots<a class="anchor" aria-label="anchor" href="#mean-cumulative-function-plots"></a>
</h2>
<p>Let <span class="math inline">\(N(t)\)</span> be the number of recurrent events occurring over the interval <span class="math inline">\([0, t]\)</span> and <span class="math inline">\(D\)</span> be the failure time of interest subjects to right censoring by <span class="math inline">\(C\)</span>. Define the composite censoring time <span class="math inline">\(Y = \min(D, C, \tau)\)</span> and the failure event indicator <span class="math inline">\(\Delta = I\{D\le \min(C, \tau)\}\)</span>, where <span class="math inline">\(\tau\)</span> is the maximum follow-up time. We assume the recurrent event process <span class="math inline">\(N(\cdot)\)</span> is observed up to <span class="math inline">\(Y\)</span>. Let <span class="math inline">\(X\)</span> be a <span class="math inline">\(p\)</span>-dimensional covariate vector. Consider a random sample of <span class="math inline">\(n\)</span> subjects, the observed data are independent and identically distributed (iid) copies of <span class="math inline">\(\{Y_i, \Delta_i, X_i, N_i(t), 0\le t\le Y_i\}\)</span>, where the subscript <span class="math inline">\(i\)</span> denotes the index of a subject for <span class="math inline">\(i= 1, \ldots, n\)</span>. Let <span class="math inline">\(m_i = N_i(Y_i)\)</span> be the number of recurrent events the <span class="math inline">\(i\)</span>th subject experienced before time <span class="math inline">\(Y_i\)</span>, then the jump times of <span class="math inline">\(N_i(t)\)</span> give the observed recurrent event times <span class="math inline">\(t_{i1}, \ldots, t_{im_i}\)</span> when <span class="math inline">\(m_i &gt; 0\)</span>. Thus, the observed data can also be expressed as iid copies of <span class="math inline">\(\{Y_i, \Delta_i, X_i, m_i, (t_{i1}, \ldots, t_{m_i})\}\)</span>.</p>
<p>Under independence censoring, a nonparametric estimate of <span class="math inline">\(\Lambda(t)\)</span> known as the Nelson-Aalen estimator is  <span class="math display">\[\widehat\Lambda(t) = \sum_{i = 1}^n\int_0^t\frac{d N_i(u)}{\sum_{j = 1}^nI(Y_i \ge u)},\]</span> which is also known as the mean cumulative function (MCF). The MCF presents the average number of recurrent events per subject observed by time~<span class="math inline">\(t\)</span> while adjusting for the risk set. In the case when all subjects remain at risk of recurrent events throughout the study, i.e., <span class="math inline">\(n = \sum_{j = 1}^nI(Y_i \ge t)\)</span>, the Nelson-Aalen estimator reduces to the cumulative sample mean function introduced in Chapter 1 of <span class="citation">Cook and Lawless (2007)</span>.</p>
<p>The MCF is useful in describing and comparing the average number of events of an individual and between groups. Thus, it provides additional insights into the longitudinal patterns of the recurrent process. Under the independent censoring assumption, the Nelson-Aalen estimate can be created by applying the generic function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to the <code>Recur</code> object with an additional argument <code>mcf = TRUE</code>. The following command plots the Nelson-Aalen estimate in Figure 7. The 95% confidence interval is enabled by additionally setting <code>mcf.conf.int = TRUE</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(reObj, <span class="dt">mcf =</span> <span class="ot">TRUE</span>, <span class="dt">mcf.conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotMCF-1.png" alt="Figure 7: Creating a MCF plot from a `Recur` object." width="576"><p class="caption">
Figure 7: Creating a MCF plot from a <code>Recur</code> object.
</p>
</div>
<p>To create the cumulative sample mean function, one needs to additionally specify the argument <code>mcf.adjustRiskset = FALSE</code>. Plotting the <code>Recur</code> object with the argument <code>mcf = TRUE</code> internally calls the <code><a href="https://wwenjie.org/reda/reference/mcf.html" class="external-link">mcf()</a></code> function from the <code>reda</code> package <span class="citation">(Wang et al. 2021)</span>. The <code><a href="https://wwenjie.org/reda/reference/mcf.html" class="external-link">mcf()</a></code> function is imported when the <code>reReg</code> package is loaded. The usage of the <code><a href="https://wwenjie.org/reda/reference/mcf.html" class="external-link">mcf()</a></code> function is similar to that of the <code>plotEvent()</code>, where the recurrent event process is specified in a model formula with <code>Recur</code> objects as the formula response and the covariates specified in the model formula should be a combination of factor variables. The <code><a href="https://wwenjie.org/reda/reference/mcf.html" class="external-link">mcf()</a></code> computes the overall sample MCF when an intercept-only-model is specified. When covariates are specified in the model formula, the sample MCF for each level of the combination of the factor variables will be computed. The following code is used to produce Figure 8, which displays the Nelson-Aalon estimates for <code>sex = "Female"</code>and <code>sex = "Male"</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>mcf0 &lt;-<span class="st"> </span><span class="kw">mcf</span>(<span class="kw">Recur</span>(t.start <span class="op">%2%</span><span class="st"> </span>t.stop, id, event, death) <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> readmission)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(mcf0, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotMCF-mcf-1.png" alt="Figure 8: Creating a MCF plot with `mcf()`" width="576"><p class="caption">
Figure 8: Creating a MCF plot with <code><a href="https://wwenjie.org/reda/reference/mcf.html" class="external-link">mcf()</a></code>
</p>
</div>
<p>In the presence of informative censoring, the NPMLE of <span class="citation">(Wang, Jewell, and Tsai 1986)</span> can be plotted by first fitting an intercept-only model with <code><a href="../reference/reReg.html">reReg()</a></code>, then applying the generic function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. The <code>Recur</code> object is used as the formula response. The following code illustrate this feature with output displayed in Figure 9.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>mcf1 &lt;-<span class="st"> </span><span class="kw">reReg</span>(<span class="kw">Recur</span>(t.start <span class="op">%2%</span><span class="st"> </span>t.stop, id, event, death) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> readmission)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(mcf1)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotMCF-reReg-1.png" alt="Figure 8: Creating a MCF plot with `reReg()`" width="576"><p class="caption">
Figure 8: Creating a MCF plot with <code><a href="../reference/reReg.html">reReg()</a></code>
</p>
</div>
<p>The 95% confidence interval is computed based on the non-parametric bootstrap approach with 200 bootstrap replicates as specified by the argument <code>B = 200</code>. Separate MCFs can be created and plotted for each level of a factor variable using the <code>subset</code> option in <code><a href="../reference/reReg.html">reReg()</a></code>. The <code><a href="../reference/basebind.html">basebind()</a></code> function can then be applied to combine the MCFs into one plot to allow easy visual comparison. The synopsis for <code><a href="../reference/basebind.html">basebind()</a></code> is shown below.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">args</span>(basebind)</span></code></pre></div>
<pre><code><span><span class="kw">function</span> <span class="op">(</span><span class="va">...</span>, <span class="va">legend.title</span>, <span class="va">legend.labels</span>, <span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="cn">NULL</span></span></code></pre>
<p>The arguments are</p>
<ul>
<li>
<code>...</code> is a list of <code>ggplot</code> objects created by plotting <code>reReg</code> objects.</li>
<li>
<code>legend.title</code> is an optional character strings to control the legend title in the combined plot.</li>
<li>
<code>legend.labels</code> is an optional character strings to control the legend labels in the combined plot.</li>
</ul>
<p>When fitting regression models with <code><a href="../reference/reReg.html">reReg()</a></code>, the <code>baseline()</code> function can be applied to combine the estimates of baseline functions across groups. The following code is used to create Figure~ 9. where the NPMLEs for <code>sex = "Female"</code> and <code>sex = "Male"</code> are presented. The corresponding 95% confidence intervals are computed with 200 bootstrap replicates.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>mcf2 &lt;-<span class="st"> </span><span class="kw">reReg</span>(<span class="kw">Recur</span>(t.start <span class="op">%2%</span><span class="st"> </span>t.stop, id, event, death) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">subset =</span> sex <span class="op">==</span><span class="st"> "Female"</span>, <span class="dt">data =</span> readmission, <span class="dt">B =</span> <span class="dv">200</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>mcf3 &lt;-<span class="st"> </span><span class="kw">update</span>(mcf2, <span class="dt">subset =</span> sex <span class="op">==</span><span class="st"> "Male"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>g1 &lt;-<span class="st"> </span><span class="kw">plot</span>(mcf2)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>g2 &lt;-<span class="st"> </span><span class="kw">plot</span>(mcf3)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">basebind</span>(g1, g2, <span class="dt">legend.title =</span> <span class="st">"Sex"</span>, <span class="dt">legend.labels =</span> <span class="kw">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>))</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/plotMCF-reReg2-1.png" alt="Figure 9: Creating a stratified MCF plot with `reReg()`" width="576"><p class="caption">
Figure 9: Creating a stratified MCF plot with <code><a href="../reference/reReg.html">reReg()</a></code>
</p>
</div>
</div>
<div class="section level2">
<h2 id="linking-with-ggplot">Linking with <code>ggplot</code><a class="anchor" aria-label="anchor" href="#linking-with-ggplot"></a>
</h2>
<p>We will take the following <code>readmission</code> data for example.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>(f &lt;-<span class="st"> </span><span class="kw">plotEvents</span>(<span class="kw">Recur</span>(t.stop, id, event, death) <span class="op">~</span><span class="st"> </span>chemo, <span class="dt">data =</span> readmission))</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/chemo0-1.png" alt="Figure 10: Event plot grouped by `chemo`." width="576"><p class="caption">
Figure 10: Event plot grouped by <code>chemo</code>.
</p>
</div>
<div class="section level4">
<h4 id="add-axis-breaks">Add axis breaks<a class="anchor" aria-label="anchor" href="#add-axis-breaks"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>f <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2000</span>, <span class="dv">100</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"Days since surgery"</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/chemo1-1.png" alt="Figure 11: Add axis breaks" width="576"><p class="caption">
Figure 11: Add axis breaks
</p>
</div>
</div>
<div class="section level4">
<h4 id="replace-labeling-strip-in-event-plot">Replace labeling strip in event plot<a class="anchor" aria-label="anchor" href="#replace-labeling-strip-in-event-plot"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"chemo = Treated"</span> =<span class="st"> "Yes"</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="op">+</span><span class="st">             "chemo = NonTreated"</span> =<span class="st"> "No"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>f <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(chemo <span class="op">~</span>., <span class="dt">scales =</span> <span class="st">"free"</span>, <span class="dt">space =</span> <span class="st">"free"</span>, <span class="dt">switch =</span> <span class="st">"both"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a><span class="op">+</span><span class="st">                </span><span class="dt">labeller =</span> <span class="kw">labeller</span>(<span class="dt">chemo =</span> labels)) <span class="op">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a><span class="op">+</span><span class="st">   </span><span class="kw">xlab</span>(<span class="st">"Received chemo?"</span>)</span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/chemo2-1.png" alt="Figure 12: Replace labeling strip in event plot" width="576"><p class="caption">
Figure 12: Replace labeling strip in event plot
</p>
</div>
</div>
<div class="section level4">
<h4 id="customize-bar-style">Customize bar style<a class="anchor" aria-label="anchor" href="#customize-bar-style"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="op">&gt;</span><span class="st"> </span>f <span class="op">+</span><span class="st"> </span><span class="kw">geom_rect</span>(<span class="dt">xmin =</span> f<span class="op">$</span>data<span class="op">$</span>id <span class="op">-</span><span class="st"> </span><span class="fl">.45</span>, <span class="co"># bar height</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="op">+</span><span class="st">               </span><span class="dt">xmax =</span> f<span class="op">$</span>data<span class="op">$</span>id <span class="op">+</span><span class="st"> </span><span class="fl">.45</span>, <span class="co"># bar height</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="op">+</span><span class="st">               </span><span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> f<span class="op">$</span>data<span class="op">$</span>time2, <span class="co"># bar width</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a><span class="op">+</span><span class="st">               </span><span class="dt">fill =</span> <span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">as.numeric</span>(f<span class="op">$</span>data<span class="op">$</span>chemo), <span class="co"># bar color</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="op">+</span><span class="st">               </span><span class="dt">alpha =</span> <span class="fl">.25</span>) <span class="co"># transparency</span></span></code></pre></div>
<div class="figure">
<img src="reReg-plot_files/figure-html/chemo3-1.png" alt="Figure 12: Replace labeling strip in event plot" width="576"><p class="caption">
Figure 12: Replace labeling strip in event plot
</p>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-cook2007statistical">
<p>Cook, Richard J., and Jerald Lawless. 2007. <em>The Statistical Analysis of Recurrent Events</em>. New York: Wiley.</p>
</div>
<div id="ref-gonzalez2005sex">
<p>González, Juan Ramón, Esteve Fernandez, Víctor Moreno, Josepa Ribes, Mercè Peris, Matilde Navarro, Maria Cambray, and Josep Maria Borrás. 2005. “Sex Differences in Hospital Readmission Among Colorectal Cancer Patients.” <em>Journal of Epidemiology &amp; Community Health</em> 59 (6): 506–11.</p>
</div>
<div id="ref-rondeau2012frailtypack">
<p>Rondeau, Virginie, Yassin Mazroui, and Juan Ramń González. 2012. “frailtypack: An R Package for the Analysis of Correlated Survival Data with Frailty Models Using Penalized Likelihood Estimation or Parametrical Estimation.” <em>Journal of Statistical Software</em> 47 (4): 1–28.</p>
</div>
<div id="ref-wang1986asymptotic">
<p>Wang, Mei-Cheng, Nicholas P. Jewell, and Wei-Yann Tsai. 1986. “Asymptotic Properties of the Product Limit Estimate Under Random Truncation.” <em>The Annals of Statistics</em> 14: 1597–1605.</p>
</div>
<div id="ref-R:reda">
<p>Wang, Wenjie, Haoda Fu, Sy Han Chiou, and Jun Yan. 2021. <em>reda: Recurrent Event Data Analysis</em>. <a href="https://github.com/wenjie2wang/reda" class="external-link">https://github.com/wenjie2wang/reda</a>.</p>
</div>
<div id="ref-R:ggplot">
<p>Wickham, Hadley. 2009. <em>ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="external-link">http://ggplot2.org</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sy Han (Steven) Chiou, Chiung-Yu Huang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
